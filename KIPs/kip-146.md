---
kip: 146
title: Random Proposer Selection
author: Ian (@ian0371), Ollie (@blukat29), Joseph (@jiseongnoh), and Aidan (@aidan-kwon)
discussions-to: https://github.com/klaytn/kips/issues/146
status: Draft
type: Standards Track
category: Core
created: 2023-06-15
---

## Simple Summary

An unpredictable and verifiable proposer selection policy

## Abstract

This standard outlines an approach for a random proposer selection policy. A proposer is determined every block in a random manner. The randomness relies on [KIP-114](https://github.com/klaytn/kips/blob/main/KIPs/kip-114.md), thereby rendering the new policy both unpredictable and verifiable.

## Motivation

Klaytn has adopted the Byzantine Fault Tolerance (BFT) consensus mechanism, where a block proposer selected by a deterministic algorithm proposes the next block. A vulnerable point of BFT is that an adversary can effectively halt the entire network by simply targeting the proposer, a.k.a. targeted DoS. What makes Klaytn even more vulnerable to a targeted DoS attack is that the current proposer selection policy enables the prediction of up to `proposerRefreshInterval` (3600 in case of Cypress) number of proposers in advance.

As of now, a targeted DoS is infeasible in Klaytn because it is a permissioned chain which allows only authorized validators to join the network. However, in permissionless network, a targeted DoS is a viable option for attackers. A random proposer selection can increase the difficulty of the attack by introducing an uncertainty of the upcoming proposers.

Meanwhile, a few malicious validators must not be able to forge the randomness to arbitrarily determine the upcoming proposers. If not, it may increase the risk of censorship or monopolizing block rewards. Therefore, the new random proposer selection policy should be both unpredictable and verifiable.

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.

### Parameters

| Constant     | Value |
| ------------ | ----- |
| `FORK_BLOCK` | TBD   |

### Proposer selection

After FORK_BLOCK, the proposer selection policy `WeightedRandom` will have the new semantic be based on two data structures:

- `proposerList`: a permutation of the validator list. `proposerList` is shuffled every `proposerRefreshInterval` blocks. This is the same as Kore hardfork.
- `picker`: defined as `(mixHash + round) % len(proposerList)`, where `mixHash` is the latest block's mixHash of [KIP-114](https://github.com/klaytn/kips/blob/main/KIPs/kip-114.md) interpreted as the bytes of a big-endian unsigned integer, and `round` is the round in consensus.

Given `proposerList` and `picker`, we select `proposerList[picker]` as the next block proposer.

This design allows a certain validator to be selected as the proposer for consecutive blocks, while guaranteeing another proposer to be selected in case of round change.

### Committee selection

## Rationale

### Existence of `proposerList`

One might wonder why bother to shuffle the validator list (i.e., `proposerList`) and then choose a random picker, instead of simply choosing one from the static validator list. The reason for using `proposerList` is that the current implementation uses it. This document aimed to minimize the implementation cost, thereby reusing the existing implementation of `proposerList` and only affecting `picker`. Note that using `proposerList` will not introduce any new security vulnerability since it is a permutation of the validator list.

### Side effect

The current algorithm for composing a committee makes sure that the proposer and the next round proposer is included in the committee. Before `FORK_BLOCK`, the next round proposer is equal to the next block proposer, and thus the next block proposer always ended up in the committee. However, after `FORK_BLOCK`, the next round proposer can be different from the next block proposer, which may result in the next block proposer not being included from the committee. This side effect does not degrade the network security; while the next proposer being in the committee could potentially be helpful to next block generation, its significance is negligible, if any.

## Backwards Compatibility

The proposer selection policy before `FORK_BLOCK` will remain the same.

## Security Considerations

`picker` is derived from `mixHash` of [KIP-114](https://github.com/klaytn/kips/blob/main/KIPs/kip-114.md). Thus, the unpredictability and verifiability of `picker` relies on those of [KIP-114](https://github.com/klaytn/kips/blob/main/KIPs/kip-114.md).

## References

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
